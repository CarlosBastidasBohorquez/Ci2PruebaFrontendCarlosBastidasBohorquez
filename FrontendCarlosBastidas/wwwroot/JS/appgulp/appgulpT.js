function log(){document.getElementById("results").innerText="",Array.prototype.forEach.call(arguments,function(e){e instanceof Error?e="Error: "+e.message:"string"!=typeof e&&(e=JSON.stringify(e,null,2)),document.getElementById("results").innerHTML+=e+"\r\n"})}var api_url="https://drsgps.co/protectedapi",authority_url="https://drsgps.co/identity",this_url="http://localhost:5003",config={authority:authority_url,client_id:"js",redirect_uri:this_url+"/callback.html",response_type:"id_token token",scope:"openid profile api1",post_logout_redirect_uri:this_url+"/index.html"},mgr=new Oidc.UserManager(config);function login(){mgr.signinRedirect()}function logout(){mgr.signoutRedirect()}function CrearTarea(){""==$("#descripCrear").val()||""==$("#fechaVencCrear").val()?(""==$("#descripCrear").val()&&(document.getElementById("descripCrear").style.border="1px solid red"),""==$("#fechaVencCrear").val()&&(document.getElementById("fechaVencCrear").style.border="1px solid red")):CrearTareaAPI({descripcion:$("#descripCrear").val(),fechaVencimiento:$("#fechaVencCrear").val()})}function CrearTareaAPI(r){mgr.getUser().then(function(e){var t=api_url+"/tareas/crear",a=new XMLHttpRequest;a.open("POST",t),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){$("#MdAgregarTarea").modal("hide"),$("#AlertaExtio").hide(),$("#AlertaExtio").show(),limpiarModalCrear(),$("#lblAlerta").text("La tarea se agrego satisfactoriamente"),Filtro()},a.setRequestHeader("Authorization","Bearer "+e.access_token),a.send(JSON.stringify(r))})}function limpiarModalCrear(){$("#descripCrear").val(""),$("#fechaVencCrear").val("")}function limpiarModalActualizar(){$("#descAct").val(""),$("#fechaVencAct").val(""),document.getElementById("InpPendiente").checked=!0,document.getElementById("InpFinalizada").checked=!0}function ValidarVa(){""!=$("#descripCrear").val()&&(document.getElementById("descripCrear").style.border=""),""!=$("#fechaVencCrear").val()&&(document.getElementById("fechaVencCrear").style.border="")}function ValidarAc(){""!=$("#descAct").val()&&(document.getElementById("descAct").style.border=""),""!=$("#fechaVencAct").val()&&(document.getElementById("fechaVencAct").style.border="")}function LimpiarBorA(){document.getElementById("descAct").style.border="",document.getElementById("fechaVencAct").style.border=""}function LimpiarBorC(){document.getElementById("descripCrear").style.border="",document.getElementById("fechaVencCrear").style.border=""}function CerrarAlerta(e){1==e&&$("#AlertaExtio").hide(),2==e&&$("#AlertaAdver").hide()}function ListarTareasApi(r){mgr.getUser().then(function(e){var t=api_url+"/tareas/consultar?"+r,a=new XMLHttpRequest;a.open("GET",t),a.onload=function(){var e=JSON.parse(a.responseText),t="";e.forEach(function(e){$("#AlertaAdver").hide(),t+='<li id="'+e.id+'" onmouseout="cambiarColorout(\''+e.id+'\')" class="list-group-item" onmouseover="cambiarColorover(\''+e.id+'\')" class="list-group-item" style="border-radius:25px"><div class="card-body" >',t+='<h5 class="card-title">Descripci√≥n:',t+='<label id="desc'+e.id+'">'+e.descripcion+"</label></h5>",t+='<h6 class="card-subtitle mb-2 text-muted">Fecha de vencimiento: ',t+='<label id="fechaVenc'+e.id+'">'+e.fechaVencimiento.substring(0,10)+"</label></h6>",t+='<p class="card-text">Finalizada:',t+='<label id="Estado'+e.id+'">'+(1==e.finalizada?"Si":"No")+"</label></p>",t+='<a class="card-button" style="margin-left:5%"><button value="'+e.id+'" onclick="MdActuali(\''+e.id+'\')" name="actualizarTarea" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-edit"></span> Actualizar</button></a>',t+='<a class="card-button" style="margin-left:60%"><button value="'+e.id+'" onclick="MdBorrar(\''+e.id+'\')" name="actualizarTarea" type="button" class="btn btn-primary" style="background-color:darkslategray;border-color:darkslategray"><span class="glyphicon glyphicon-trash"></span> Borrar</button></a>',t+="</div></li>"}),document.getElementById("ListaTareas").innerHTML=t,0==e.length&&($("#AlertaAdver").hide(),$("#AlertaAdver").show(),$("#lblAlertaAdver").text("No hay tareas registradas con los filtros seleccionados"))},a.setRequestHeader("Authorization","Bearer "+e.access_token),a.send(null)})}function cambiarColorover(e){document.getElementById(e).style.background="gainsboro"}function cambiarColorout(e){document.getElementById(e).style.background=""}function Filtro(){var e="";""!=$("#textoTareDescripcion").val()&&(e="descripcion="+$("#textoTareDescripcion").val()),$("#filtroTareTodas").is(":checked"),$("#filtroTareFinalizadas").is(":checked")&&(""!=e&&(e+="&"),e+="finalizada=true"),$("#filtroTarePendientes").is(":checked")&&(""!=e&&(e+="&"),e+="finalizada=false"),ListarTareasApi(e)}function FiltroBoton(){var e=Filtro();""!=$("#textoTareDescripcion").val()&&"descripcion="+$("#textoDescripcion").val()}function MdBorrar(e){$("#lblidElimi").text(e),$("#descElimi").text($("#desc"+e).text()),$("#fechaVencElimi").val($("#fechaVenc"+e).text().substring(0,10)),"No"==$("#Estado"+e).text()?$("#InpPendienteElimi").attr("checked",!0):$("#InpFinalizadaElimi").attr("checked",!0),$("#MdEliminarTarea").modal("show")}function MdActuali(e){LimpiarBorA(),$("#lblid").text(e),$("#descAct").val($("#desc"+e).text()),$("#fechaVencAct").val($("#fechaVenc"+e).text().substring(0,10)),"No"==$("#Estado"+e).text()?document.getElementById("InpPendiente").checked=!0:document.getElementById("InpFinalizada").checked=!0,$("#MdActualizarTarea").modal("show")}function EliminarTarea(){var r=$("#lblidElimi").text();mgr.getUser().then(function(e){var t=api_url+"/tareas/borrar",a=new XMLHttpRequest;a.open("POST",t),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){$("#MdEliminarTarea").modal("hide"),$("#AlertaExtio").hide(),$("#AlertaExtio").show(),$("#lblAlerta").text("La tarea se elimnino satisfactoriamente"),$("#lblidElimi").text(null),Filtro()},a.setRequestHeader("Authorization","Bearer "+e.access_token),a.send(JSON.stringify({id:r}))})}function ActualizarTarea(){if(""==$("#descAct").val()||""==$("#fechaVencAct").val())""==$("#descAct").val()&&(document.getElementById("descAct").style.border="1px solid red"),""==$("#fechaVencAct").val()&&(document.getElementById("fechaVencAct").style.border="1px solid red");else if(null!=$("#lblid").text()){var r={id:$("#lblid").text(),descripcion:$("#descAct").val(),fechaVencimiento:$("#fechaVencAct").val(),finalizada:$("#InpFinalizada").is(":checked")};mgr.getUser().then(function(e){var t=api_url+"/tareas/actualizar",a=new XMLHttpRequest;a.open("POST",t),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){$("#MdActualizarTarea").modal("hide"),$("#AlertaExtio").hide(),$("#AlertaExtio").show(),limpiarModalActualizar(),$("#lblAlerta").text("La tarea se actualizo satisfactoriamente"),$("#lblid").text(null),Filtro()},a.setRequestHeader("Authorization","Bearer "+e.access_token),a.send(JSON.stringify(r))})}}mgr.getUser().then(function(e){e?($("#NameUser").text(e.profile.name),document.getElementById("filtroTareTodas").checked=!0,Filtro()):location.href="index.html"});